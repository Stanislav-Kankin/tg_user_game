<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rocket Game</title>
    <link rel="stylesheet" href="../static/style.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        const tg = window.Telegram.WebApp;
        const defaultUrl = "https://3f86-147-45-193-130.ngrok-free.app"; // TUNNEL

        document.addEventListener('DOMContentLoaded', () => {
            const rocket = document.getElementById('rocket');
            const asteroid1 = document.getElementById('asteroid1');
            const asteroid2 = document.getElementById('asteroid2');
            const asteroid3 = document.getElementById('asteroid3');
            const asteroid4 = document.getElementById('asteroid4');
            const gameContainer = document.getElementById('game-container');
            const scoreDisplay = document.getElementById('score');
            const levelDisplay = document.getElementById('level');
            let score = 0;
            let level = 1;
            let gameOver = false;

            let isDragging = false;
            let offsetX, offsetY;

            rocket.addEventListener('mousedown', (e) => {
                isDragging = true;
                offsetX = e.clientX - rocket.getBoundingClientRect().left;
                offsetY = e.clientY - rocket.getBoundingClientRect().top;
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    let x = e.clientX - offsetX;
                    let y = e.clientY - offsetY;
                    rocket.style.left = `${x}px`;
                    rocket.style.top = `${y}px`;
                }
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });

            rocket.addEventListener('touchstart', (e) => {
                isDragging = true;
                const touch = e.touches[0];
                offsetX = touch.clientX - rocket.getBoundingClientRect().left;
                offsetY = touch.clientY - rocket.getBoundingClientRect().top;
            });

            document.addEventListener('touchmove', (e) => {
                if (isDragging) {
                    const touch = e.touches[0];
                    let x = touch.clientX - offsetX;
                    let y = touch.clientY - offsetY;
                    rocket.style.left = `${x}px`;
                    rocket.style.top = `${y}px`;
                }
            });

            document.addEventListener('touchend', () => {
                isDragging = false;
            });

            function moveAsteroid(asteroid, delay) {
                if (gameOver) return;
                asteroid.style.top = '-50px';
                asteroid.style.left = `${Math.random() * (gameContainer.clientWidth - 50)}px`;
                asteroid.style.transition = `top ${delay}s linear`;
                asteroid.style.top = `${gameContainer.clientHeight}px`;

                setTimeout(() => {
                    asteroid.style.transition = 'none';
                    moveAsteroid(asteroid, delay);
                }, delay * 1000);
            }

            function checkCollision() {
                if (gameOver) return;
                const rocketRect = rocket.getBoundingClientRect();
                const rocketCenterX = rocketRect.left + rocketRect.width / 2;

                const rocketCenterY = rocketRect.top + rocketRect.height / 2;

                const asteroid1Rect = asteroid1.getBoundingClientRect();
                const asteroid2Rect = asteroid2.getBoundingClientRect();
                const asteroid3Rect = asteroid3.getBoundingClientRect();
                const asteroid4Rect = asteroid4.getBoundingClientRect();

                // Действие проверки коллизии здесь
                // Добавьте логику обработки коллизий и обновления счета игры
            }

            // Запуск астероидов
            moveAsteroid(asteroid1, 3);
            moveAsteroid(asteroid2, 4);
            moveAsteroid(asteroid3, 2);
            moveAsteroid(asteroid4, 5);
        });
    </script>
</head>
<body>
    <div id="game-container">
        <div id="background1"></div>
        <div id="background2"></div>
        <div id="rocket"></div>
        <div id="asteroid1" class="asteroid"></div>
        <div id="asteroid2" class="asteroid"></div>
        <div id="asteroid3" class="asteroid"></div>
        <div id="asteroid4" class="asteroid"></div>
        <div id="score">Score: 0</div>
        <div id="level">Level: 1</div>
        <div class="message" id="game-over-message" style="display: none;">Game Over</div>
    </div>
</body>
</html>
